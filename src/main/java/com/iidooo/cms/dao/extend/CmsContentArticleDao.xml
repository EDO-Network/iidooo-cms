<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.iidooo.cms.dao.extend.CmsContentArticleDao" >
  <resultMap id="BaseResultMap" type="com.iidooo.cms.dto.extend.CmsContentArticleDto" >
    <id column="ContentID" property="contentID" jdbcType="INTEGER" />
	<result column="ChannelID" jdbcType="INTEGER" property="channelID" />
	<result column="ContentType" jdbcType="CHAR" property="contentType" />
	<result column="ContentTitle" jdbcType="VARCHAR" property="contentTitle" />
	<result column="ContentSubTitle" jdbcType="VARCHAR" property="contentSubTitle" />
	<result column="ContentImageTitle" jdbcType="VARCHAR" property="contentImageTitle" />
	<result column="MetaTitle" jdbcType="VARCHAR" property="metaTitle" />
	<result column="MetaKeywords" jdbcType="VARCHAR" property="metaKeywords" />
	<result column="MetaDescription" jdbcType="VARCHAR" property="metaDescription" />
	<result column="ContentSummary" jdbcType="VARCHAR" property="contentSummary" />
	<result column="Sequence" jdbcType="INTEGER" property="sequence" />
	<result column="IsAllowComment" jdbcType="INTEGER" property="isAllowComment" />
    <result column="ArticleType" property="articleType" jdbcType="CHAR" />
	<result column="Remarks" property="remarks" jdbcType="VARCHAR" />
	<result column="CreateTime" property="createTime" jdbcType="VARCHAR" />
	<result column="CreateUser" property="createUser" jdbcType="INTEGER" />
	<result column="UpdateTime" property="updateTime" jdbcType="VARCHAR" />
	<result column="UpdateUser" property="updateUser" jdbcType="INTEGER" />
	<result column="IsDelete" property="isDelete" jdbcType="INTEGER" />
	<result column="Version" property="version" jdbcType="INTEGER" />
  </resultMap>
  <resultMap id="ResultMapWithBLOBs" type="com.iidooo.cms.dto.extend.CmsContentArticleDto" extends="BaseResultMap">
	<result column="ContentBody" property="contentBody" jdbcType="LONGVARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    C.ContentID, C.ContentType, C.ChannelID, C.ContentTitle, C.ContentSubTitle, C.ContentImageTitle,
	C.MetaTitle,
	C.MetaKeywords,
	C.MetaDescription, C.ContentSummary,
	C.Sequence,
	C.IsAllowComment, A.ArticleType, C.Remarks, C.CreateTime, C.CreateUser,
	C.UpdateTime, C.UpdateUser, C.IsDelete, C.Version
  </sql>
  <sql id="Blob_Column_List" >
    C.ContentBody
  </sql>
  <select id="selectContentArticles" resultMap="BaseResultMap">
  	select
	<include refid="Base_Column_List" />		
	from IDO_CMS_CONTENT C
	join IDO_CMS_CONTENT_ARTICLE A on C.IsDelete = 0 and C.ContentID = A.ContentID 
	and C.ChannelID = #{channelID,jdbcType=INTEGER}
	and A.ArticleType = #{articleType,jdbcType=INTEGER}
	order by C.Sequence asc limit 0, #{count,jdbcType=INTEGER}
  </select>
  
  <select id="selectArticlesCountByChannelID" resultType="java.lang.Integer">
  	select count(*)	
	from IDO_CMS_CONTENT C
	join IDO_CMS_CONTENT_ARTICLE A on C.IsDelete = 0 and C.ContentID = A.ContentID 
	and C.ChannelID = #{channelID,jdbcType=INTEGER}
	join IDO_SECURITY_USER U on C.CreateUser = U.UserID and U.IsDelete = 0
  </select>
  <select id="selectArticlesByChannelID" resultMap="BaseResultMap">
  	select
	<include refid="Base_Column_List" />, U.UserName as createUserName
	from IDO_CMS_CONTENT C
	join IDO_CMS_CONTENT_ARTICLE A on C.IsDelete = 0 and C.ContentID = A.ContentID 
	and C.ChannelID = #{channelID,jdbcType=INTEGER}
	join IDO_SECURITY_USER U on C.CreateUser = U.UserID and U.IsDelete = 0
	order by C.UpdateTime desc limit #{page.start}, #{page.pageSize}
  </select>
  
  <select id="selectByContentID" resultMap="ResultMapWithBLOBs" parameterType="java.lang.Integer">
  	select 
	<include refid="Base_Column_List" />,
	<include refid="Blob_Column_List" />
	from IDO_CMS_CONTENT C
	join IDO_CMS_CONTENT_ARTICLE A on C.IsDelete = 0 and C.ContentID = A.ContentID 
	and C.ContentID = #{contentID, jdbcType=INTEGER}
  </select>
  
  <insert id="insert" parameterType="com.iidooo.cms.dto.extend.CmsContentArticleDto">
  	insert into IDO_CMS_CONTENT_ARTICLE (ContentID, ArticleType)
    values (#{contentID,jdbcType=INTEGER}, #{articleType,jdbcType=CHAR})
  </insert>
  
   <update id="updateByPrimaryKey" parameterType="com.iidooo.cms.dto.extend.CmsContentArticleDto" >
    update IDO_CMS_CONTENT_ARTICLE
    set ArticleType = #{articleType,jdbcType=CHAR}
    where ContentID = #{contentID,jdbcType=INTEGER}
  </update>

</mapper>